<?php

/*
===========================================================

	프로젝트 이름 : Piree WON Program

	만든사람 : 피리

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 01월 23일 목요일 오전 10시 38분, 날씨 추워~ B급으로 추워~

	저 작 권 : Copyright ⓒ 2014 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 피리 출석체크 FREE G5 > 출석체크 하기
===========================================================


20140123 || 1390484348


INSERT INTO `piree__attend_list__0_1` VALUES (0,20140119,1,1,'admin','FREE G5',1,0,'아직 출석체크하신 분이 없습니다.','211.36.144.11',1390087513);
INSERT INTO `piree__attend_list__0_1` VALUES (0,20140120,1,1,'admin','FREE G5',2,0,'아직 출석체크하신 분이 없습니다.','211.36.144.11',1390173913);
INSERT INTO `piree__attend_list__0_1` VALUES (0,20140121,1,1,'admin','FREE G5',3,0,'아직 출석체크하신 분이 없습니다.','211.36.144.11',1390260313);
INSERT INTO `piree__attend_list__0_1` VALUES (0,20140122,1,1,'admin','FREE G5',4,0,'아직 출석체크하신 분이 없습니다.','211.36.144.11',1390346713);
INSERT INTO `piree__attend_list__0_1` VALUES (0,20140123,1,1,'admin','FREE G5',5,0,'아직 출석체크하신 분이 없습니다.','211.36.144.11',1390433113);


*/


	#########################################################
	# 시작 => 라이브러리__화일__첨부____선처리
	#########################################################

	//=======================================================
	// 라이브러리__첨부
	include_once ('./_common.php');


	//=======================================================
	// 시작 => 회원_여부__확인
	IF ($is_guest || !$is_member)
	{
		alert ("회원만 이용하실 수 있습니다", G5_DOMAIN."/");
		EXIT;
	}
	// 끝 => 회원_여부__확인
	//=======================================================

	#########################################################
	# 끝 => 라이브러리__화일__첨부____선처리
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING
	#########################################################

	//=======================================================
	// QUERY_STRING
	$page_n = $_GET["page_n"];


	//=======================================================
	// 형변환
	$page_n = (int)$page_n;

	#########################################################
	# 끝 => QUERY_STRING
	#########################################################



	#########################################################
	# 시작 => 출석체크__설정_정보_화일__첨부
	#########################################################

	//=======================================================
	// 피리_메뉴__번호
	$piree_menu_n = 760003;


	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	$is_get__piree_config = 0;


	//=======================================================
	// 출석체크__설정_정보__가져오기
	$is_get__attend_config = 1;


	//=======================================================
	// 출석체크__설정_정보_화일__경로
	$piree_dir_path = "../_config/p__".$piree_menu_n."/pi__config.php";


	//=======================================================
	// 출석체크__설정_정보_화일__경로
	include_once ($piree_dir_path);

	#########################################################
	# 끝 => 출석체크__설정_정보_화일__첨부
	#########################################################



	#########################################################
	# 시작 => 출석_가능__여부__확인
	#########################################################

	//=======================================================
	// 출석_가능__여부
	// 0 - 불가
	// 1 - 가능
	$is_use__attend = chk__attend_time();

	#########################################################
	# 끝 => 출석_가능__여부__확인
	#########################################################



	#########################################################
	# 시작 => 상수__변수
	#########################################################

	//=======================================================
	// 출석_회원__건수
	$attend_view_n = 0;


	//=======================================================
	// 출석_회원__배열
	$attend_list_arr = array();


	//=======================================================
	// 오늘
	$today_time_n = (int)date("Ymd");


	//=======================================================
	// 출석_시작__시간
	$attend_start_time = $attend_config["start_time_H"]."시 ".$attend_config["start_time_i"]."분";


	//=======================================================
	// 출석_마감__시간
	$attend_close_time = $attend_config["close_time_H"]."시 ".$attend_config["close_time_i"]."분";

	#########################################################
	# 끝 => 상수__변수
	#########################################################



	#########################################################
	# 시작 => 달력_정보__가져오기
	#########################################################

	//=======================================================
	// 달력_정보__가져옥기
	$sql		= "SELECT * FROM `".$piree_table['calendar']."` WHERE date_n=".$today_time_n;
	$calrow = sql_fetch($sql);


	//=======================================================
	// 시작 => 달력_정보__있으면
	IF ($today_time_n == $calrow["date_n"])
	{

		//=====================================================
		// 날짜
		$cal_date_Y = $calrow["date_Y"];
		$cal_date_m = $calrow["date_m"];
		$cal_date_d = $calrow["date_d"];


		//=====================================================
		// 요일
		$cal_yoil_n = $calrow["yoil_n"];
		$cal_yoil_s = get_yoil($calrow["yoil_n"], $full=1);


		//=====================================================
		// 음력
		$cal_lunar_Ymd = $calrow["lunar_Ymd"];


		//=====================================================
		// 음력__배열_나누기
		$cal_lunar_ex = explode("-", $calrow["lunar_Ymd"]);


		//=====================================================
		// 음력__날짜
		$cal_lunar_date_Y = $cal_lunar_ex[0];
		$cal_lunar_date_m = $cal_lunar_ex[1];
		$cal_lunar_date_d = $cal_lunar_ex[2];


		//=====================================================
		// 간지
		$cal_cha_gapja_s = $calrow["cha_gapja_s"];


		//=====================================================
		// 24절기
		$cal_is_24_jeolki = $calrow["is_24_jeolki"];


		//=====================================================
		// 오늘_출석체크_한__회원
		$cal_attend_t = $calrow["attend_t"];

	}
	// 끝 => 달력_정보__있으면
	//=======================================================

	#########################################################
	# 끝 => 달력_정보__가져오기
	#########################################################



	#########################################################
	# 시작 => 출석체크_목록__불러오기
	#########################################################

	//=======================================================
	// 시작 => 출석체크_목록__있으면
	IF ($cal_attend_t > 0)
	{

		#######################################################
		# 시작 => 목록_관련__상수__변수
		#######################################################

		//=====================================================
		// 한_화면__글수
		$rows_n = $config['cf_page_rows'];


		//=====================================================
		// 전체_페이지__수
		$total_page_n = ceil($cal_attend_t / $rows_n);


		//=====================================================
		// 페이지_없으면__첫_페이지__1_페이지
		IF (!$page_n || $page_n < 1)								 $page_n = 1;


		//=====================================================
		// 시작__열
		$start_record_n = ($page_n - 1) * $rows_n;

		#######################################################
		# 끝 => 목록_관련__상수__변수
		#######################################################



		#######################################################
		# 시작 => 출석체크_목록__불러오기
		#######################################################

		//=====================================================
		// 출석체크_목록__불러오기
		$sql		= "SELECT * FROM `".$piree_table['attend_list']."` ";
		$sql	 .= "WHERE date_n=".$today_time_n." ORDER BY seq_n ASC LIMIT ".$start_record_n.", ".$rows_n;
		$result = sql_query($sql);


		//=====================================================
		// 시작 => 반복문__돌리기
		WHILE ($row = sql_fetch_array($result))
		{

			//===================================================
			// 순서
			$attend_list_arr[$attend_view_n]["seq_n"] = $row["seq_n"];


			//===================================================
			// 회원__번호
			$attend_list_arr[$attend_view_n]["mem_mn"] = $row["mem_mn"];


			//===================================================
			// 회원__아이디
			$attend_list_arr[$attend_view_n]["mb_id"] = $row["mb_id"];


			//===================================================
			// 회원__닉네임
			$attend_list_arr[$attend_view_n]["mb_nick"] = $row["mb_nick"];


			//===================================================
			// 연속일
			$attend_list_arr[$attend_view_n]["conti_n"] = $row["conti_n"];


			//===================================================
			// 선택__번호
			$attend_list_arr[$attend_view_n]["select_n"] = $row["select_n"];


			//===================================================
			// 한마디
			$attend_list_arr[$attend_view_n]["cont_s"] = stripslashes($row["cont_s"]);


			//===================================================
			// 출석_시간__숫자
			$attend_list_arr[$attend_view_n]["regi_time_n"]	= $row["regi_time_n"];


			//===================================================
			// 출석_시간__문자열
			$attend_list_arr[$attend_view_n]["regi_time_s"] = date("A H:i", $row["regi_time_n"]);


			//===================================================
			// 출석_회원__건수__증가
			$attend_view_n++;

		}
		// 끝 => 반복문__돌리기
		//=====================================================

		#######################################################
		# 끝 => 출석체크_목록__불러오기
		#######################################################

	}
	// 끝 => 출석체크_목록__있으면
	//=======================================================

	#########################################################
	# 끝 => 출석체크_목록__불러오기
	#########################################################



	#########################################################
	# 시작 => 마무리__페이지_ECHO_관련
	#########################################################

	//=======================================================
	// 타이틀
	$g5["title"] = "피리 출석체크 FREE G5";


	//=======================================================
	// HEAD_첨부
	include_once ("./_head.php");


	//=======================================================
	// 스킨__첨부
	include_once ($attend_config["skin_pc_p"]."/attend_index.php");


	//=======================================================
	// BOTTOM_첨부
	include_once ("./_tail.php");

	#########################################################
	# 끝 => 마무리__페이지_ECHO_관련
	#########################################################


?>