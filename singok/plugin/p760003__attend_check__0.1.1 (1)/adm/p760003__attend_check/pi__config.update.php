<?php

/*
===========================================================

	프로젝트 이름 : Piree WON Program PLUS G5 (유료)	

	만든사람 : 피리

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 11월 15일 토요일 오전 02시 15분, 날씨 맑지만 춥다

	저 작 권 : Copyright ⓒ 2014 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 관리자 > 피리 > 피리 출석체크 FREE G5 > 변경 신청 > 처리
===========================================================


*/


	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 메뉴_번호__지정____출석체크
	$sub_menu = "760003";


	//=======================================================
	// 기본처리_화일__첨부
	include_once ("./_common.php");


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], "r");

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => 레벨__설정_정보_화일__첨부
	#########################################################

	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	// 1 - 하자
	$is_get__piree_config = 1;


	//=======================================================
	// 출석체크__설정_정보__가져오기
	$is_get__attend_config = 1;


	//=======================================================
	// 설정_화면__여부
	$is_piree_program_config = 1;


	//=======================================================
	// 레벨__설정_정보_화일__경로
	$piree_dir_path = PIREE_CONFIG_PATH ."/p__".$sub_menu."/pi__config.php";


	//=======================================================
	// 레벨__설정_정보_화일__경로
	include_once ($piree_dir_path);

	#########################################################
	# 끝 => 레벨__설정_정보_화일__첨부
	#########################################################



	#########################################################
	# 시작 => 피리__기본_정보_화일__첨부
	#########################################################

	//=======================================================
	// 피리__기본_정보_화일__경로
	$piree_admin_lib_path = G5_ADMIN_PATH ."/_piree/pi__lib.php";


	//=======================================================
	// 피리__기본_정보_화일__첨부
	include_once ($piree_admin_lib_path);


	//=======================================================
	// 프로그램_정보__저장하기
	save_piree__program_info();

	#########################################################
	# 끝 => 피리__기본_정보_화일__첨부
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING__형변환
	#########################################################

	//=======================================================
	// QUERY_STRING
	$skin_pc_c		 = $_POST["skin_pc_c"];
	$skin_mobile_c = $_POST["skin_mobile_c"];
	$start_time_H	= $_POST["start_time_H"];
	$start_time_i	= $_POST["start_time_i"];
	$close_time_H	= $_POST["close_time_H"];
	$close_time_i	= $_POST["close_time_i"];
	$attend_point	= $_POST["attend_point"];
	$regular_day_n = $_POST["regular_day_n"];
	$regular_point = $_POST["regular_point"];
	$rank_1_point	= $_POST["rank_1_point"];


	//=======================================================
	// 형변환
	$start_time_H	= (int)$start_time_H;
	$start_time_i	= (int)$start_time_i;
	$close_time_H	= (int)$close_time_H;
	$close_time_i	= (int)$close_time_i;
	$attend_point	= (int)$attend_point;
	$regular_day_n = (int)$regular_day_n;
	$regular_point = (int)$regular_point;
	$rank_1_point	= (int)$rank_1_point;

	#########################################################
	# 끝 => QUERY_STRING__형변환
	#########################################################



	#########################################################
	# 시작 => 검증
	#########################################################

	//=======================================================
	// 시작 => 시작_시각__마감_시각__검증
	IF ($start_time_H >= $close_time_H)
	{
		// 에러
		alert ("출석체크 [ 마감 시간 ] 은 [ 시작 시간] 보다 더 늦어야 합니다.", $go_url_s);
		EXIT;
	}
	// 끝 => 시작_시각__마감_시각__검증
	//=======================================================

	#########################################################
	# 끝 => 검증
	#########################################################



	#########################################################
	# 시작 => 상수__변수
	#########################################################

	//=======================================================
	// 정보_저장__여부
	// 0 - 실패
	// 1 - 성공
	$is_save = 0;


	//=======================================================
	// 이동할_페이지
	$go_url_s = "./index.php";

	#########################################################
	# 끝 => 상수__변수
	#########################################################



	#########################################################
	# 시작 => 출석_체크_설정__저장하기
	#########################################################

		#######################################################
		# 시작 => 공통_쿼리__조합
		#######################################################

		//=====================================================
		// 공통_쿼리__조합
		$sql_save	= "prog_n='".$g_program_n."', ";
		$sql_save .= "prog_s='".$g_program_s."', ";


		//=====================================================
		// 스킨
		$sql_save .= "skin_pc_c = '".$skin_pc_c."', ";
		$sql_save .= "skin_mobile_c = '".$skin_mobile_c."', ";


		//=====================================================
		// 시작_시간_시각__코드_메모
		$config_c = "start_time_H";
		$config_m = "출석체크 시작하는 시간의 시각 입니다.";


		//=====================================================
		// 시작_시간_시각__공통_쿼리
		$sql_save .= "pp_cf_1_c = '".$config_c."', ";
		$sql_save .= "pp_cf_1_m = '".$config_m."', ";
		$sql_save .= "pp_cf_1_n = ".$start_time_H.", ";
		$sql_save .= "pp_cf_1_s = '', ";


		//=====================================================
		// 시작_시간_분__코드_메모
		$config_c = "start_time_i";
		$config_m = "출석체크 시작하는 시간의 분 입니다.";


		//=====================================================
		// 시작_시간_분__공통_쿼리
		$sql_save .= "pp_cf_2_c = '".$config_c."', ";
		$sql_save .= "pp_cf_2_m = '".$config_m."', ";
		$sql_save .= "pp_cf_2_n = ".$start_time_i.", ";
		$sql_save .= "pp_cf_2_s = '', ";


		//=====================================================
		// 마감__시간_시각__코드_메모
		$config_c = "close_time_H";
		$config_m = "출석체크 마감하는 시간의 시각 입니다.";


		//=====================================================
		// 마감__시간_시각__공통_쿼리
		$sql_save .= "pp_cf_3_c = '".$config_c."', ";
		$sql_save .= "pp_cf_3_m = '".$config_m."', ";
		$sql_save .= "pp_cf_3_n = ".$close_time_H.", ";
		$sql_save .= "pp_cf_3_s = '', ";


		//=====================================================
		// 마감__시간_분__코드_메모
		$config_c = "close_time_i";
		$config_m = "출석체크 마감하는 시간의 분 입니다.";


		//=====================================================
		// 마감__시간_분__공통_쿼리
		$sql_save .= "pp_cf_4_c = '".$config_c."', ";
		$sql_save .= "pp_cf_4_m = '".$config_m."', ";
		$sql_save .= "pp_cf_4_n = ".$close_time_i.", ";
		$sql_save .= "pp_cf_4_s = '', ";


		//=====================================================
		// 포인트__코드_메모
		$config_c = "attend_point";
		$config_m = "출석체크 하면 지급하는 포인트 점수입니다.";


		//=====================================================
		// 포인트__공통_쿼리
		$sql_save .= "pp_cf_5_c = '".$config_c."', ";
		$sql_save .= "pp_cf_5_m = '".$config_m."', ";
		$sql_save .= "pp_cf_5_n = ".$attend_point.", ";
		$sql_save .= "pp_cf_5_s = '', ";


		//=====================================================
		// 개근_날짜__코드_메모
		$config_c = "regular_day_n";
		$config_m = "출석 개근 여부를 확인하는 날짜수입니다. 예) 7일, 10일";


		//=====================================================
		// 개근_날짜__공통_쿼리
		$sql_save .= "pp_cf_6_c = '".$config_c."', ";
		$sql_save .= "pp_cf_6_m = '".$config_m."', ";
		$sql_save .= "pp_cf_6_n = ".$regular_day_n.", ";
		$sql_save .= "pp_cf_6_s = '', ";


		//=====================================================
		// 개근_포인트__코드_메모
		$config_c = "regular_point";
		$config_m = "출석 개근 했을때 지급하는 회원에게 지급하는 포인트 점수입니다.";


		//=====================================================
		// 개근_포인트__공통_쿼리
		$sql_save .= "pp_cf_7_c = '".$config_c."', ";
		$sql_save .= "pp_cf_7_m = '".$config_m."', ";
		$sql_save .= "pp_cf_7_n = ".$regular_point.", ";
		$sql_save .= "pp_cf_7_s = '', ";


		//=====================================================
		// 1등_포인트__코드_메모
		$config_c = "rank_1_point";
		$config_m = "그날 출석체크 1등 하는 회원에게 지급하는 포인트 점수입니다.";


		//=====================================================
		// 1등_포인트__공통_쿼리
		$sql_save .= "pp_cf_11_c = '".$config_c."', ";
		$sql_save .= "pp_cf_11_m = '".$config_m."', ";
		$sql_save .= "pp_cf_11_n = ".$rank_1_point.", ";
		$sql_save .= "pp_cf_11_s = '', ";

		#######################################################
		# 끝 => 공통_쿼리__조합
		#######################################################



		#######################################################
		# 시작 => 설정__저장하기
		#######################################################

		//=====================================================
		// 수정하는__쿼리
		$sql	= "UPDATE `".$piree_table['program']."` SET ";
		$sql .= $sql_save;
		$sql .= "modi_time_n='".G5_SERVER_TIME."' ";
		$sql .= "WHERE prog_n=".$g_program_n;


		//=====================================================
		// 시작 => 쿼리_실행
		IF (!sql_query($sql))
		{

			// 에러_메세지
			$save_err_msg = "출석체크 설정 정보를 수정하지 못했습니다.";

			// 에러
			alert ($save_err_msg, $go_url_s);
			EXIT;

		}
		// 끝 => 쿼리_실행
		//=====================================================

		#######################################################
		# 끝 => 설정__저장하기
		#######################################################

	#########################################################
	# 끝 => 출석_체크_설정__저장하기
	#########################################################



	#########################################################
	# 시작 => 마무리__페이지_이동
	#########################################################

	//=======================================================
	// 페이지_이동
	goto_url($go_url_s);
	EXIT;

	#########################################################
	# 끝 => 마무리__페이지_이동
	#########################################################


?>