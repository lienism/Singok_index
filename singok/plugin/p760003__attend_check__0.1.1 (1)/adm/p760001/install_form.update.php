<?php

/*
===========================================================

	프로젝트 이름 : Piree WON Program FREE G5 (유료)	

	만든사람 : 피리

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 11월 20일 목요일 오전 1시 19분, 날씨 맑고 쌀쌀하다

	저 작 권 : Copyright ⓒ 2014 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 관리자 > 피리 > FREE G5 > 설치하기
===========================================================


*/


	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 메뉴_번호__지정
	$sub_menu = "760001";


	//=======================================================
	// 기본처리_화일__첨부
	include_once ("./_common.php");


	//=======================================================
	// 시작 => 회원_여부__확인
	IF ($is_guest || !$is_member)
	{
		alert ("회원만 이용하실 수 있습니다", G5_DOMAIN."/");
		EXIT;
	}
	// 끝 => 회원_여부__확인
	//=======================================================


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], "w");

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => FREE_G5__설정_정보_화일__첨부
	#########################################################

	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	// 1 - 하자
	$is_get__piree_config = 0;


	//=======================================================
	// FREE_G5__설정_정보_화일__경로
	$piree_dir_path = PIREE_CONFIG_PATH ."/p__".$sub_menu."/pi__config.php";


	//=======================================================
	// FREE_G5__설정_정보_화일__경로
	include_once ($piree_dir_path);

	#########################################################
	# 끝 => FREE_G5__설정_정보_화일__첨부
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING__형변환
	#########################################################

	//=======================================================
	// QUERY_STRING____POST
	$is_table_drop = $_POST['is_table_drop'];


	//=======================================================
	// 형변환
	$is_table_drop = (int)$is_table_drop;

	#########################################################
	# 끝 => QUERY_STRING__형변환
	#########################################################



	#########################################################
	# 시작 => 
	#########################################################

	//=======================================================
	// 시작 => 
	// 끝 => 
	//=======================================================


	//=======================================================
	// 시작 => 
	// 끝 => 
	//=======================================================

	#########################################################
	# 끝 => 
	#########################################################



	#########################################################
	# 시작 => 그누보드5_FREE____테이블__생성하기
	#########################################################

	//=======================================================
	// 설정_디렉토리
	$config_dir_s = "p__".PIREE_PROG_FREE_MENU_N;


	//=======================================================
	// 테이블_생성
	$file = implode('', file(PIREE_CONFIG_PATH.'/'.$config_dir_s.'/pi__schema.sql'));
	eval("\$file = \"$file\";");


	//=======================================================
	// 문자열_치환
	$file = preg_replace('/^--.*$/m', '', $file);
	$file = preg_replace('/`g5_([^`]+`)/', '`'.G5_TABLE_PREFIX.'$1', $file);


	//=======================================================
	// 쿼리문__배열_나누기
	$sql_arr = explode(';', $file);


	//=======================================================
	// 시작 => 반복문__돌리기
	FOR ($i=0; $i<count($sql_arr); $i++)
	{

		//=====================================================
		// 쿼리문_앞뒤__공백_제거
		$sql_in = trim($sql_arr[$i]);


		//=====================================================
		// 시작 => 쿼리문__있으면
		IF (trim($sql_in))
		{

			//===================================================
			// 시작 => 테이블_삭제__선택하지_않았으면
			IF ($is_table_drop != 1)
			{

				//=================================================
				// 시작 => 삭제_쿼리__이면
				IF (eregi("^DROP TABLE", $sql_in))
				{

					// 건너뛰기
					continue;

				}
				// 끝 => 삭제_쿼리__이면
				//=================================================

			}
			// 끝 => 테이블_삭제__선택하지_않았으면
			//===================================================


			//===================================================
			// 쿼리__실행하기
			mysql_query($sql_in) or die(mysql_error());

		}
		// 끝 => 쿼리문__있으면
		//=====================================================

	}
	// 끝 => 반복문__돌리기
	//=======================================================

	#########################################################
	# 끝 => 그누보드5_FREE____테이블__생성하기
	#########################################################



	#########################################################
	# 시작 => 페이지__이동
	#########################################################

	//=======================================================
	// 이동할__페이지
	$move_url = G5_ADMIN_URL.'/p'.$sub_menu.'/';


	//=======================================================
	// 알림창
	alert ("필요한 테이블을 생성하였습니다.", $move_url, 0);
	EXIT;

	#########################################################
	# 끝 => 페이지__이동
	#########################################################


?>