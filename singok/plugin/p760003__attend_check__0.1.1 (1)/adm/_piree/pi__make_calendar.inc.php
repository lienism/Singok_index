<?php

/*
===========================================================

	프로젝트 이름 : Piree WON Program PLUS G5 (유료)	

	만든사람 : 피리

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 01월 22일 수요일 오전 01시 27분, 날씨 추워~ B급으로 추워~

	저 작 권 : Copyright ⓒ 2014 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 관리자 > 피리 > 피리 출석체크 PLUS G5 > 변경 신청 > 처리
===========================================================


*/


	#########################################################
	# 시작 => 선처리
	#########################################################

	//=======================================================
	// 개별_페이지__접근_불가
	IF (!defined('_GNUBOARD_'))					EXIT;

	#########################################################
	# 끝 => 선처리
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING
	#########################################################

	//=======================================================
	// QUERY_STRING
	$year_n = $_GET["year_n"];


	//=======================================================
	// 형변환
	$year_n = (int)$year_n;


	//=======================================================
	// 올해_년도
	$year_now = date("Y");


	//=======================================================
	// 시작 => 년도__없으면
	IF (!$year_n || $year_n < 1)
	{
		$year_n = $year_now;
	}
	// 끝 => 년도__없으면
	//=======================================================

	#########################################################
	# 끝 => QUERY_STRING
	#########################################################



	#########################################################
	# 시작 => 상수__변수
	#########################################################

	//=======================================================
	// QUERY_STRING
	$year_n = $_GET["year_n"];


	//=======================================================
	// 형변환
	$year_n = (int)$year_n;


	//=======================================================
	// 올해_년도
	$year_now = date("Y");


	//=======================================================
	// 시작 => 년도__없으면
	IF (!$year_n || $year_n < 1)
	{
		$year_n = $year_now;
	}
	// 끝 => 년도__없으면
	//=======================================================

	#########################################################
	# 끝 => 상수__변수
	#########################################################



	#########################################################
	# 시작 => 피리__기본_설정_화일__첨부
	#########################################################

	//=======================================================
	// 기본__설정_정보_화일__경로
	$piree_dir_path = PIREE_CONFIG_PATH ."/p__".$menu_grp_n."/pi__config.php";


	//=======================================================
	// 기본__설정_정보_화일__경로
	include_once ($piree_dir_path);

	#########################################################
	# 끝 => 피리__기본_설정_화일__첨부
	#########################################################



	#########################################################
	# 시작 => 달력__입력하기
	#########################################################

	//=======================================================
	// 기본__설정_정보_화일__경로
	$piree_base_config_path = PIREE_CONFIG_PATH ."/_piree";


	//=======================================================
	// 데이터_화일
	$date_data_file = $piree_base_config_path."/date_".$year_n.".php";


	//=======================================================
	// 시작 => 데이터_화일__있으면
	IF (file_exists($date_data_file))
	{

		//=====================================================
		// 데이터_화일__첨부
		include ($date_data_file);


		//=====================================================
		// 시작 => 배열_건수__있으면
		IF (count($dates) > 0)
		{

			//===================================================
			// 시작 => 반복문__돌리기
			WHILE (list($key, $val) = each($dates))
			{

				//=================================================
				// 월
				$month_s = $val[0] > 9 ? $val[0] : "0".$val[0];


				//=================================================
				// 일
				$day_s = $val[1] > 9 ? $val[1] : "0".$val[1];


				//=================================================
				// 날짜_숫자형
				$date_n = $year_n.$month_s.$day_s;
				$date_n = (int)$date_n;


				//=================================================
				// ROW__유무_확인하는__쿼리문
				$sql	 = "SELECT COUNT(*) AS exist FROM `".$piree_table['calendar']."` WHERE date_n=".$date_n;
				$row	 = sql_fetch($sql);
				$exist = @$row["exist"];


				//=================================================
				// 시작 => ROW__없으면
				IF (!$exist || $exist < 1)
				{

					//===============================================
					// 입력_쿼리문
					$sql	= "INSERT INTO `".$piree_table['calendar']."` (num,date_n,date_Y,date_m,date_d,date_Ymd,yoil_n,yoil_seq,lunar_Ymd,kor_gapja_s,cha_gapja_s,is_holiday,is_24_jeolki,regi_time_n) ";
					$sql .= "VALUES (0,".$date_n.",".$year_n.",".$val[0].",".$val[1].",'".$val[2]."',".$val[3].",".$val[4].",'".$val[5]."','".$val[6]."','".$val[7]."',".$val[8].",'".$val[9]."',".G5_SERVER_TIME.")";
												// num, date_n,		 date_Y,		date_m,		 date_d,			 date_Ymd,		yoil_n,		 yoil_seq,		lunar_Ymd,		kor_gapja_s,	cha_gapja_s, is_holiday,	is_24_jeolki,regi_time_n


					//===============================================
					// 시작 => 삭제__실행하기
					IF (!sql_query($sql))
					{

						// 메세지
						$msg = "날짜 [ ".$val[2]." ] 를 저장하지 못했습니다.";

						// 에러
						alert ($msg, $go_url_s);
						EXIT;

					}
					// 끝 => 수정하기
					//===============================================

				}
				// 끝 => ROW__없으면
				//=================================================

			}
			// 끝 반복문__돌리기
			//===================================================

		}
		// 끝 => 배열_건수__있으면
		//=====================================================

	}
	// 끝 => 데이터_화일__있으면
	//=======================================================


	//=======================================================
	// 년도__증가
	$year_n++;

	#########################################################
	# 끝 => 달력__입력하기
	#########################################################


?>